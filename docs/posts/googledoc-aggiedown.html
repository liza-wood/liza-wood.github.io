<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liza Wood">
<meta name="dcterms.date" content="2023-09-13">

<title>Liza Wood - Translating Google Docs to aggiedown LaTeX</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Liza Wood</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops.html" rel="" target="">
 <span class="menu-text">Workshops / Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/liza-wood/" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wood__liza" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pre-requisites" id="toc-pre-requisites" class="nav-link active" data-scroll-target="#pre-requisites">Pre-requisites</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set-up</a></li>
  <li><a href="#doing-your-thing-in-google-docs" id="toc-doing-your-thing-in-google-docs" class="nav-link" data-scroll-target="#doing-your-thing-in-google-docs">Doing your thing in Google Docs</a></li>
  <li><a href="#r-chapter-projects" id="toc-r-chapter-projects" class="nav-link" data-scroll-target="#r-chapter-projects">R chapter projects</a></li>
  <li><a href="#aggiedown" id="toc-aggiedown" class="nav-link" data-scroll-target="#aggiedown"><code>aggiedown</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Translating Google Docs to <code>aggiedown</code> LaTeX</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liza Wood </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>In 2018, Ryan Peek created the <a href="https://github.com/ryanpeek/aggiedown">aggiedown</a> package: “An R Markdown template using the bookdown package for preparing a PhD thesis at the University of California Davis.” This service to the PhD students of UC Davis is incredible – it lets students link their dissertation to a lovely LaTeX format that should, ideally, make your formatting process easy and compliant with the <a href="https://grad.ucdavis.edu/preparing-filing-your-thesis-or-dissertation#fguidelines">Graduate Studies formatting guidelines</a>. So, I wanted to continue the legacy by keeping the template alive and well (you should too, by following the <a href="https://github.com/liza-wood/aggiedown/blob/master/CONTRIBUTING.md">guide to contributing</a> updates as necessary during use!).</p>
<p>Beyond using the template, I wanted to make my dissertation-writing life as easy as possible by integrating my mode of writing (Google Docs) with the <code>aggiedown</code> template. As it stands, Peek proposes either writing chapters directly into the chapter Rmd files in the package, or knitting from a “child” Rmd that lives inside a specific project. While both of these options are great, working in Google Docs until the very end let me work in edits from my committee up until the last minute, and allowed me to work with my reference manager of choice (Zotero plug-in to Google Docs) instead of dealing much with BibTeX.</p>
<p>So, I created a workflow for converting a Google Doc with Zotero-embedded references into an Rmd document that will play nicely with LaTeX templates. Though I designed this for <code>aggiedown</code>, it is likely tweak-able for other LaTeX templates as well. This tutorial outlines what to do, however, it assumes you have read the <code>aggiedown</code> README file for an understanding of how that package works first.</p>
<section id="pre-requisites" class="level2">
<h2 class="anchored" data-anchor-id="pre-requisites">Pre-requisites</h2>
<ol type="1">
<li><em>Skill-level</em>. This workflow is for someone with intermediate coding skills, in part because I didn’t bug-proof the functions very much and so it may require some tweaking. I’d say an ideal candidate is someone who understands what LaTeX is – but doesn’t really know how to use it – and understands Rmd well-enough (e.g.&nbsp;someone who is past the learning curve of spending hours on getting a <code>kable</code> just right and hardly ever gets working directory errors anymore).<br>
</li>
<li><em>Software</em>. Writing in Google Docs and embedding references using <a href="https://www.zotero.org/support/google_docs">Zotero Google Docs plug-in</a>. Please download the BibTex format for Zotero so that you have this option below. Downloads can happen just by navigating Zotero &gt; Settings to the box (below) searching via the ‘Get additional styles…’ link.<br>
</li>
<li><em><code>aggiedown</code></em>. Please read the <code>aggiedown</code> documentation first, as this tutorial takes for granted a general understanding of the workflow and recommendations made in that package. It builds directly on the recommendations and formatting style of the package.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/bibtext-option.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set-up</h2>
<ol type="1">
<li><em>Writing in Google Docs</em>. The Introduction and each Chapter is a document, so your set-up should look something like this.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/dissertation-drive.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><em>Coding in R Projects</em>. Each chapter has an R project (ideally – though in reality you just need to know the filepaths of all your figures and tables). I’ll leave this to your imagination.</li>
</ol>
</section>
<section id="doing-your-thing-in-google-docs" class="level2">
<h2 class="anchored" data-anchor-id="doing-your-thing-in-google-docs">Doing your thing in Google Docs</h2>
<p>So, you’re writing your dissertation in a Google Doc. Great. You should use docs as you wish, with only a few things to pay attention to.</p>
<ol type="1">
<li><p><em>Use headers appropriately</em>. Google Docs (like Word) has text related settings where you can set Titles, Header 1, Header 2, etc. These translated well to Markdown, and so we need to make sure we use these in a consistent and compatible way with the dissertation format. Your Chapter Title should be Header 1, and then all main sections (e.g.&nbsp;Introduction, Methods, etc.) should be Header 2. You can continue down to subsections as much as you wish. For references, please make a Header 1 titled ‘References’ at the end of the document.</p></li>
<li><p><em>Chapter marks</em>. To get friendly chapter marks, as advised by Ryan Peek in the <code>aggiedown</code> guidelines, you can embed this right into the doc (e.g.&nbsp;[backslash]chaptermark {organic seed policy}. Also note that because this is Chapter 1, I have a set-up chunk with the packages I need to read in images and load tables. More on chunks in the next point.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/googledoc.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><em>Code chunks</em>. So, you’ll need to manually insert chunks, which is a trickier part. You can surely paste in your figures and tables and stuff as you write. But towards the end you’ll want to work with the model of inserting chunks into the text instead of the inserting figures and tables. For example, here I am loading in a figure, which is easy to you only need to set your chunk options and load the right path.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/chunk-in-doc.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Tables are a little trickier. All of my tables are saved as .csv files in my projects, and I have to read them in and do some manual changes to get them right. This means sometimes renaming column names and setting some <code>kable</code> and <code>kableExtra</code> options to get my table just right. <strong>Important:</strong> be sure to include a colon (;) after each line of code so that eventually the rendering will recognize a line break in the code.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/chunk-in-doc2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p><em>Zotero settings</em>. You can write the dissertation with any citation format you want via Zotero (MLA, APSA, etc.), but when you’re in the end/knitting phase, you’ll want to switchto BibTex format. See above for the directions for downloading and switching the Settings for the Style Manager. Note, in text this options is very ugly, but the heart of the conversion function is making it into something usable, so deal with it.</p></li>
<li><p><em>References</em>. I said it in 1., but it bears repeating. Insert your bibliography under a Header 1 sections called “References”. The spelling a capitalization matters here, so please be conscious of that.</p></li>
<li><p><em>Misc formatting</em>. This conversion will recognize simple markup like bolding and italics, will ignore things like comments in the document, but it will panic a little but over highlighting. Please don’t use highlight markup. To embed links, you can use standard markdown link embedding. For citing page numbers, I have not figured out how to put this into the workflow, so I just do not link these inline citations to Zotero.</p></li>
</ol>
</section>
<section id="r-chapter-projects" class="level2">
<h2 class="anchored" data-anchor-id="r-chapter-projects">R chapter projects</h2>
<p>You’ll have to manage your chapters as projects. However you do this, you’ll need to build in a few features.</p>
<ol type="1">
<li>For each chapter project, save your figures and tables in sensible places with sensible names. For example, I have a tables and figures directory for each project, and in each of those projects I have just named them by numbers. You can do whatever naming convention you wish, you’ll just need to know the path for later.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/fig-dir.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>In each chapter project, create a manuscript folder. For example, in this project I have a ch1-manuscript/ directory. This will be a path you use for later, as it is where the functions I’ve made will create your chapter Rmd documents.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ch1-dir.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aggiedown" class="level2">
<h2 class="anchored" data-anchor-id="aggiedown"><code>aggiedown</code></h2>
<p>You’ll also have a project from following the directions to clone the <code>aggiedown</code> package. A few additions here can help the workflow.</p>
<ol type="1">
<li><p><em>Intro directory</em>. In the <code>aggiedown</code> project, create an intro/ directory. This is where your introduction will be rendered from.</p></li>
<li><p><em>Script to prep chapters</em>. Create a prep_papers.R script in the main directory. This is where you will call in two functions from my open source function repo, woodshop. These functions are <code>prep_diss_chapters</code> and <code>auto_bib</code>.</p></li>
</ol>
<pre><code>
devtools::install_github('liza-wood/woodshop')

introurl &lt;- 'https://docs.google.com/document/d/1rhGeXrAtk8hdtB1uymg1WwaD_P3Xv3oz_lm1sl4Qnao/edit#'
intropath &lt;- '~/Documents/Davis/R-Projects/aggiedown_dissertation/intro/'

ch1url &lt;- 'https://docs.google.com/document/d/1T9K308unavSzrx7A4ZsXRTScazhfeAVHGT-rtawP1x4/edit'
ch1path &lt;- '~/Documents/Davis/R-Projects/organicseed_adoption/ch1-manuscript/'

ch2url &lt;- 'https://docs.google.com/document/d/1wsDqDBgijoXFMuOlyHa3hSlUwcNLpUWnRna11r8dxzs/edit'
ch2path &lt;- '~/Documents/Davis/R-Projects/osisn_spatial/ch2-manuscript/'

ch3url &lt;- 'https://docs.google.com/document/d/1OWRFWWUNgEmn2VDEcj6bS8uc_lL1VnteS5jK-_YyhII/edit'
ch3path &lt;- '~/Documents/Davis/R-Projects/osisn_processes/ch3-manuscript/'

woodshop::prep_diss_chapters(introurl, intropath, intro = T)
woodshop::prep_diss_chapters(ch1url, ch1path)
woodshop::prep_diss_chapters(ch2url, ch2path)
woodshop::prep_diss_chapters(ch3url, ch3path)

woodshop::auto_bib_file(intropath, ch1path, ch2path, ch3path)
</code></pre>
<p>After running this code in the prep_papers.R file, the directories created in each chapter project should fill out.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ch1-inside.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><em>Knit children</em>. In each chapter .Rmd built in to the <code>aggiedown</code> package (e.g.&nbsp;01-chap1.Rmd), you’ll want to set them up so that they knit from the Rmds created in the previous step. In each chapter Rmd, you can mimic the following code chunk to draw it in. This is the only thing you need in each chapter Rmd.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/knitchild.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><em>Final touches</em>. At the very end (i.e.&nbsp;you’re not going to run prep_papers.R any more) you can make any specific manual edits that you’d like by directly editing the chapter’s Rmd in the chapter project. For example, one of the main bugs that I hadn’t solved relates to footnotes. They overwrite one another because they do not get continuously numbered. If you have footnotes, you’ll need to run each chapter Rmd and make the numbers continous, otherwise you’ll have issues.</li>
</ol>
<p>Once you’ve followed these steps, you should be able to knit from the index.Rmd file in the <code>aggiedown</code> package and render your thesis, stored as thesis.pdf in the book/ directory of the project.</p>
<p>A few pages are below as an example. On page v., the rendering takes all of the first and second headers from the Google Doc into the table of contents. On page 5, you see the chapter title, introduction header, and then that references are embedded and linked to the bibliography, formatted based on how I specified the csl. Then on pages 16 and 19, the figure and table I showed as chunks in text are fitting in the final rendering. Note also that the page header alternatives between chapter mark on even pages (e.g.&nbsp;CHAPTER 1. ORGANIC SEED POLICY) and subsection headers on odd pages (e.g.&nbsp;3. METHODS).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/toc.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ch1main.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ch1p16.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ch1p19.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>